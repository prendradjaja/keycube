!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).cubeSolver=t()}(this,function(){"use strict";function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function e(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function c(o){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?t(Object(i),!0).forEach(function(e){var t,n,r;t=o,r=i[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(i,e))})}return o}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function b(e){return 0===e||1===e?1:(0<re[e]||(re[e]=b(e-1)*e),re[e])}function p(e,t){if(e<t)return 0;for(;e>=oe.length;){for(var n=oe.length,r=[],o=r[0]=1,i=n-1;o<n;o+=1)r[o]=oe[i][o-1]+oe[i][o];r[n]=1,oe.push(r)}return oe[e][t]}function i(e,t){return Math.floor(Math.random()*(t-e+1))+e}function s(e,t){var n=e.slice(0);n[t[0]]=e[t[t.length-1]];for(var r=1;r<t.length;r+=1)n[t[r]]=e[t[r-1]];return n}function v(e,t,n){for(var r=e[t],o=t;o<n;o+=1)e[o]=e[o+1];e[n]=r}function y(e,t,n){for(var r=e[n],o=n;t<o;--o)e[o]=e[o-1];e[t]=r}function o(e,t){for(var n=0,r=0;r<e.length-1;r+=1)n=t*n+e[r];return n}function l(e,t,n){for(var r=[],o=0,i=t-2;0<=i;--i){var a=e%n;e=Math.floor(e/n),o+=r[i]=a}return r[t-1]=(n-o%n)%n,r}function d(e){for(var t=0,n=e.length-1;0<n;--n)for(var r=n-1;0<=r;--r)e[r]>e[n]&&(t+=1);return t%2}function g(e,t,n){var r=2<arguments.length&&void 0!==n&&n,o=e.length-1,i=0,a=1,u=[];if(r)for(var f=e.length-1;0<=f;--f)0<=t.indexOf(e[f])&&(o=Math.min(o,e[f]),i+=p(e.length-1-f,a),u.unshift(e[f]),a+=1);else for(var s=0;s<e.length;s+=1)0<=t.indexOf(e[s])&&(o=Math.min(o,e[s]),i+=p(s,a),u.push(e[s]),a+=1);for(var l=0,c=u.length-1;0<c;--c){for(var h=0;u[c]!==t[c];)v(u,0,c),h+=1;l=(c+1)*l+h}return b(t.length)*i+l}function m(e,t,n,r){for(var o=3<arguments.length&&void 0!==r&&r,i=b(t.length),a=Math.floor(e/i),u=e%i,f=[],s=0;s<n;s+=1)f.push(-1);for(var l=1;l<t.length;l+=1){var c=u%(l+1);for(u=Math.floor(u/(l+1));0<c;)y(t,0,l),--c}var h=t.length-1;if(o)for(var v=0;v<n;v+=1){var d=p(n-1-v,h+1);0<=a-d&&(f[v]=t[t.length-1-h],a-=d,--h)}else for(var g=n-1;0<=g;--g){var m=p(g,h+1);0<=a-m&&(f[g]=t[h],a-=m,--h)}return f}function x(e){return/^([FRUBLDfrubldxyzMSE][2']?\s*)+$/.test(e)}function T(e,t){var n=1<arguments.length&&void 0!==t&&t;if(!x(e))throw new Error("Invalid algorithm provided to algorithm parser");var r=[],o=h(function(o){o=o.reduce(function(e,t){var n=t.charAt(0),r=t.charAt(1);return ae[n]?e.concat(ae[n].map(function(e){return e+r})):e.concat(t)},[]);for(var i=[],a=[],e=function(e){var t=o[e].charAt(0),n=ie[o[e].charAt(1)];if("xyz".includes(t)){a.unshift(o[e]);for(var r=0;r<=n;r+=1)i=i.map(function(e){return ue[t]["FRUBLD".indexOf(e[0])]+e.charAt(1)})}else i.unshift(o[e])},t=o.length-1;0<=t;--t)e(t);return[i,a]}(e.match(/[FRUBLDfrubldxyzMSE][2']?/g)),2),i=o[0],a=o[1];return i.forEach(function(e){var t="FRUBLD".indexOf(e.charAt(0)),n=ie[e.charAt(1)];r.push(3*t+n)}),n?[r,a]:r}function w(e){var t="";return e.forEach(function(e){switch(t+=" ",t+="FRUBLD".charAt(Math.floor(e/3)),e%3){case 1:t+="2";break;case 2:t+="'"}}),t.trim()}function O(e,t,n){for(var r=e,o=n[Math.floor(t/3)],i=t%3,a=0;a<=i;a+=1)r=s(r,o);return r}function M(e,t){return O(e,t,xe)}function P(e,t){return O(e,t,Te)}function z(e,t){var n=Math.floor(t/3),r=xe[n],o=t%3,i=M(e,t);if((0===n||3===n)&&o%2==0)for(var a=0;a<4;a+=1)i[r[a]]=(i[r[a]]+1)%2;return i}function E(e,t){var n=Math.floor(t/3),r=Te[n],o=t%3,i=P(e,t);if(2!==n&&5!==n&&o%2==0)for(var a=0;a<4;a+=1)i[r[a]]=(i[r[a]]+(a+1)%2+1)%3;return i}function D(t){return new Oe({name:t.name,moves:t.moves,defaultIndex:g([0,1,2,3,4,5,6,7],t.affected,t.reversed),size:t.size||b(8)/b(8-t.affected.length),getVector:function(e){return m(e,t.affected.slice(),8,t.reversed)},cubieMove:P,getIndex:function(e){return g(e,t.affected,t.reversed)}})}function j(t){return new Oe({name:t.name,moves:t.moves,defaultIndex:g([0,1,2,3,4,5,6,7,8,9,10,11],t.affected,t.reversed),size:t.size||b(12)/b(12-t.affected.length),getVector:function(e){return m(e,t.affected.slice(),12,t.reversed)},cubieMove:M,getIndex:function(e){return g(e,t.affected,t.reversed)}})}function I(n,r,o){for(var i=[],e=Math.pow(o,r-1),t=Math.pow(o,r-n.length-1),a=function(e){var t=l(e,r,o);n.every(function(e){return 0===t[e]})&&i.push(e)},u=0;u<e&&i.length<t;u+=1)a(u);return i}function F(e){return new Oe({name:e.name,size:2048,solvedIndexes:I(e.affected,12,2),getVector:function(e){return l(e,12,2)},cubieMove:z,getIndex:function(e){return o(e,2)}})}function U(e){return new Oe({name:e.name,size:2187,solvedIndexes:I(e.affected,8,3),getVector:function(e){return l(e,8,3)},cubieMove:E,getIndex:function(e){return o(e,3)}})}function k(e){return ze.solve({scramble:e})}function A(e){return Ee.solve({scramble:e})}function R(e){return De.solve({scramble:e})}function S(e,t){var n=1<arguments.length&&void 0!==t?t:22;return Array.isArray(e)?Fe.solve({indexes:e,maxDepth:n}):Fe.solve({scramble:e,maxDepth:n})}function L(e,t,n,r){return S([Math.floor(g(t,[8,9,10,11],!0)/24),o(n,3),o(e,2),g(t,[8,9,10,11],!0),d(r),g(r,[0,1,2,3,4,5]),g(t,[0,1,2]),g(t,[3,4,5])])}function V(e){return Ue.solve({scramble:e})}function B(e,t,n){var r=l(i(0,Math.pow(t,e.length-1)),e.length,t),o=Array(n).fill(0);return e.forEach(function(e,t){o[e]=r[t]}),o}function C(e,t){var n=m(i(0,b(e.length)),e.slice(0),e.length),r=[0,1,2,3,4,5,6,7,8,9,10,11].slice(0,t);return e.forEach(function(e,t){r[e]=n[t]}),r}function _(e,t){t=t||i(0,4);for(var n=0;n<t;n+=1)e=s(e,ke);return e}function $(e,t,n,r,o,i){for(var a,u,f,s,l=2<arguments.length&&void 0!==n?n:e,c=3<arguments.length&&void 0!==r?r:t,h=4<arguments.length&&void 0!==o&&o,v=5<arguments.length&&void 0!==i&&i;a=B(l,2,12),u=C(e,12),h&&(u=_(u)),f=B(c,3,8),s=C(t,8),v&&(s=_(s)),d(u)!==d(s););return L(a,u,f,s)}function q(){return $([fe,se,le,ce],[],[],[ge,me,be,pe],!1,!0)}function G(){for(var e,t,n,r;e=l(i(0,2048),12,2),n=l(i(0,2187),8,3),t=m(i(0,479001600),[0,1,2,3,4,5,6,7,8,9,10,11],12),r=m(i(0,40320),[0,1,2,3,4,5,6,7],8),d(t)!==d(r););return L(e,t,n,r)}function H(){return $([fe,se,le,ce,he,ve],[ge,me,be,pe])}function J(){return $([],[0,1,2,3,4,5,6,7])}function K(){return $([0,1,2,3,4,5,6,7,8,9,10,11],[])}function N(){return $(Ae,[],Ae,[],!1,!0)}function Q(){return $([fe,se,le,ce,de],[ge,me,be,pe,ye])}function W(){return $([fe,se,le,ce],[ge,me,be,pe],[],[])}function X(){return $(Re,Se,[],Se)}function Y(){return $([fe,se,le,ce,de],Le,[],Le)}var Z,ee,te,ne,re=[],oe=[],ie={"":0,2:1,"'":2},ae={f:["z","B"],r:["x","L"],u:["y","D"],b:["z'","F"],l:["x'","R"],d:["y'","U"],M:["x'","R","L'"],S:["z","F'","B"],E:["y'","U","D'"]},ue={x:"DRFULB",y:"RBULFD",z:"FULBDR"},fe=0,se=1,le=2,ce=3,he=5,ve=7,de=8,ge=0,me=1,be=2,pe=3,ye=4,xe=[[1,8,5,9],[0,11,4,8],[1,2,3,0],[3,10,7,11],[2,9,6,10],[5,4,7,6]],Te=[[1,0,4,5],[0,3,7,4],[0,1,2,3],[3,2,6,7],[2,1,5,6],[5,4,7,6]],we=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],Oe=function(){function t(n){var r=this;if(u(this,t),this.name=n.name,this.size=n.size,this.defaultIndex=n.defaultIndex||0,this.solvedIndexes=n.solvedIndexes||[this.defaultIndex],n.doMove&&(this.doMove=function(e,t){return n.doMove(r.table,e,t)}),n.table)this.table=n.table;else{var o,i,a,e=(o=n.getVector,i=n.cubieMove,a=n.getIndex,function(e,t){var n=o(e);return n=i(n,t),a(n)});this.createMoveTable(n.size,e,n.moves)}}return e(t,[{key:"doMove",value:function(e,t){return this.table[e][t]}},{key:"createMoveTable",value:function(e,t,n){var r=2<arguments.length&&void 0!==n?n:we;this.table=[];for(var o=0;o<e;o+=1)this.table.push([]);for(var i=0;i<e;i+=1)for(var a=0;a<r.length;a+=1){var u=r[a];if(!this.table[i][u]){var f=t(i,u),s=u-u%3*2+2;this.table[i][u]=f,this.table[f][s]=i}}}}]),t}(),Me=function(){function n(e,t){u(this,n),this.computePruningTable(e,t)}return e(n,[{key:"setPruningValue",value:function(e,t){this.table[e>>3]^=(15^t)<<((7&e)<<2)}},{key:"getPruningValue",value:function(e){return this.table[e>>3]>>((7&e)<<2)&15}},{key:"computePruningTable",value:function(e,t){var n=e.reduce(function(e,t){return e*t.size},1);this.table=[];for(var r=0;r<n+7>>3;r+=1)this.table.push(-1);for(var o=0,i=0,a=[1],u=1;u<e.length;u+=1)a.push(e[u-1].size*a[u-1]);for(var f,s,l,c=(f=e.map(function(e){return e.solvedIndexes}),s=[],l=f.length-1,function e(t,n){for(var r=0;r<f[n].length;r+=1){var o=t.slice(0);o.push(f[n][r]),n===l?s.push(o):e(o,n+1)}}([],0),s),h=0;h<c.length;h+=1){for(var v=0,d=0;d<c[h].length;d+=1)v+=a[d]*c[h][d];this.setPruningValue(v,0),i+=1}for(;i!==n;){var g=n/2<i,m=g?15:o,b=g?o:15;o+=1;for(var p=0;p<n;p+=1)if(this.getPruningValue(p)===m)for(var y=0;y<t.length;y+=1){for(var x=t[y],T=p,w=0,O=a.length-1;0<=O;--O)w+=a[O]*e[O].doMove(Math.floor(T/a[O]),x),T%=a[O];if(this.getPruningValue(w)===b){if(i+=1,g){this.setPruningValue(p,o);break}this.setPruningValue(w,o)}}}}}]),n}(),Pe=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:we;u(this,n),this.createTables=e,this.moves=t}return e(n,[{key:"initialize",value:function(){var o=this;if(!this.initialized){this.initialized=!0;var e=this.createTables(),t=e.moveTables,n=e.pruningTables;this.moveTables=t,this.pruningTables=[],n.forEach(function(e){var t=e.map(function(e){return o.moveTables.map(function(e){return e.name}).indexOf(e)});t.sort(function(e,t){return o.moveTables[e].size-o.moveTables[t].size});var n=[];t.forEach(function(e){return n.push(o.moveTables[e])});var r=new Me(n,o.moves);o.pruningTables.push({pruningTable:r,moveTableIndexes:t})})}}},{key:"handleSolution",value:function(e,t){return{solution:e,indexes:t}}},{key:"search",value:function(e,t,n,r){for(var o=0,i=0;i<this.pruningTables.length;i+=1){for(var a=e[this.pruningTables[i].moveTableIndexes[0]],u=1,f=1;f<this.pruningTables[i].moveTableIndexes.length;f+=1)u*=this.moveTables[this.pruningTables[i].moveTableIndexes[f-1]].size,a+=e[this.pruningTables[i].moveTableIndexes[f]]*u;var s=this.pruningTables[i].pruningTable.getPruningValue(a);if(t<s)return!1;o<s&&(o=s)}if(0===o)return this.handleSolution(r,e);if(0<t)for(var l=0;l<this.moves.length;l+=1){var c=this.moves[l];if(Math.floor(c/3)!==Math.floor(n/3)&&Math.floor(c/3)!==Math.floor(n/3)-3){for(var h=[],v=0;v<e.length;v+=1)h.push(this.moveTables[v].doMove(e[v],c));var d=this.search(h,t-1,c,r.concat([c]));if(d)return d}}return!1}},{key:"solve",value:function(e){var n=this;this.initialize(),this.settings=c({maxDepth:22,lastMove:null,format:!0},e);var t,r=this.settings.indexes||[];if(this.settings.scramble){var o=h(T(this.settings.scramble,!0),2),i=o[0],a=o[1];0<a.length&&(t=function(e){if(!x(e))throw new Error("Invalid algorithm provided to algorithm parser");return e.match(/[FRUBLDfrubldxyzMSE][2']?/g).reverse().map(function(e){var t=e.charAt(0),n=ie[e.charAt(1)],r=n-n%3*2+2;return 1==r?"".concat(t,"2"):2==r?"".concat(t,"'"):t}).join(" ")}(a.join(" ")));for(var u=0;u<this.moveTables.length;u+=1)r.push(this.moveTables[u].defaultIndex);i.forEach(function(e){for(var t=0;t<r.length;t+=1)r[t]=n.moveTables[t].doMove(r[t],e)})}for(var f=0;f<=this.settings.maxDepth;f+=1){var s=this.search(r,f,this.settings.lastMove,[]);if(s){if(this.settings.format){var l=w(s.solution);return t?w(T("".concat(t," ").concat(l))):l}return s}}return!1}}]),n}(),ze=new Pe(function(){return{moveTables:[j({name:"EdgePermutation",affected:[4,5,6,7]}),F({name:"EdgeOrientation",affected:[4,5,6,7]})],pruningTables:[["EdgePermutation"],["EdgeOrientation"]]}}),Ee=new Pe(function(){return{moveTables:[F({name:"EdgeOrientation",affected:[0,1,2,3,4,5,6,7,8,9,10,11]}),j({name:"EdgePermutation",affected:[5,7]})],pruningTables:[["EdgeOrientation"],["EdgePermutation"]]}}),De=new Pe(function(){return{moveTables:[F({name:"EdgeOrientation",affected:[6,9,10]}),U({name:"CornerOrientation",affected:[5,6]}),j({name:"EdgePermutation",affected:[6,9,10]}),D({name:"CornerPermutation",affected:[5,6]})],pruningTables:[["EdgeOrientation","CornerPermutation"],["CornerOrientation","CornerPermutation"],["EdgePermutation","CornerPermutation"]]}}),je=[1,10,4,13,6,7,8,15,16,17],Ie=new Pe(function(){function e(e,t){for(var n=m(e,[0,1,2],12),r=m(t,[3,4,5],12),o=0;o<8;o+=1)if(-1!==n[o]){if(-1!==r[o])return-1;r[o]=n[o]}return g(r,[0,1,2,3,4,5])}ne=[];for(var t=0;t<336;t+=1){ne.push([]);for(var n=0;n<336;n+=1)ne[t][n]=e(t,n)}return{moveTables:[new Oe({name:"slicePermutation",size:24,table:te.table}),Z,ee,j({name:"URToDF",size:20160,moves:je,affected:[0,1,2,3,4,5]})],pruningTables:[["slicePermutation","parity","URFToDLF"],["slicePermutation","parity","URToDF"]]}},je),Fe=new(function(){function i(){var e,t;u(this,i);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=f(this,(e=a(i)).call.apply(e,[this].concat(r)))).maxDepth=22,t.solution=null,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}(i,Pe),e(i,[{key:"handleSolution",value:function(e,t){var n=e.slice(-1)[0];if(n%2==0&&6===Math.floor(n/3)&&15===Math.floor(n/3))return!1;var r=Ie.solve({indexes:[t[3],t[4],t[5],ne[t[6]][t[7]]],maxDepth:this.maxDepth-e.length,lastMove:n,format:!1});if(r){if(this.solution=e.concat(r.solution),this.maxDepth<=this.settings.maxDepth)return{solution:this.solution,indexes:t};this.maxDepth=this.solution.length-1}return!1}}]),i}())(function(){return Z=new Oe({name:"parity",size:2,table:[[1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1],[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]]}),ee=D({name:"URFToDLF",affected:[0,1,2,3,4,5]}),te=j({name:"slice",affected:[8,9,10,11],reversed:!0}),Ie.initialize(),{moveTables:[new Oe({name:"slicePosition",size:495,table:te.table,doMove:function(e,t,n){return Math.floor(e[24*t][n]/24)}}),U({name:"twist",affected:[0,1,2,3,4,5,6,7]}),F({name:"flip",affected:[0,1,2,3,4,5,6,7,8,9,10,11]}),te,Z,ee,j({name:"URToUL",affected:[0,1,2]}),j({name:"UBToDF",affected:[3,4,5]})],pruningTables:[["slicePosition","flip"],["slicePosition","twist"]]}}),Ue=new Pe(function(){return{moveTables:[j({name:"EdgePermutation",affected:[4,5,6,7,9]}),F({name:"EdgeOrientation",affected:[4,5,6,7,9]}),D({name:"CornerPermutation",affected:[5]}),U({name:"CornerOrientation",affected:[5]})],pruningTables:[["EdgePermutation","CornerPermutation"],["EdgeOrientation","CornerOrientation"]]}}),ke=[0,1,2,3],Ae=[fe,se,le,ce,he,ve],Re=[fe,se,le,ce],Se=[ge,me,be,pe],Le=[ge,me,be,pe,ye];return{solve:function(e,t){var n=1<arguments.length&&void 0!==t?t:"kociemba",r={kociemba:S,cross:k,eoline:A,fb:R,xcross:V};if(r[n])return r[n](e);throw new Error("Specified solver does not exist.")},scramble:function(e){var t=0<arguments.length&&void 0!==e?e:"3x3",n={"3x3":G,"2gll":q,cmll:H,corners:J,edges:K,lse:N,lsll:Q,pll:W,zbll:X,zzls:Y};if(n[t])return n[t]();throw new Error("Specified scrambler does not exist.")},initialize:function(e){var t={cross:ze,eoline:Ee,fb:De,xcross:Ue};if("kociemba"===e)Fe.initialize(),Ie.initialize();else{if(!t[e])throw new Error("Specified solver does not exist.");t[e].initialize()}}}});
